<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">

        <title>RZRQ</title>
        <meta name="description" content="The HTML5 Herald">
        <meta name="author" content="@nanoix9">

        <link href="/static/css/c3.min.css" rel="stylesheet" type="text/css">

        <!-- Load jquery, d3.js and c3.js -->
        <script src="/static/js/jquery-2.2.1.js" charset="utf-8"></script>
        <script src="/static/js/d3.min.js" charset="utf-8"></script>
        <script src="/static/js/c3.min.js"></script>

    </head>

    <body>
        <div id="chart"></div>
        <script>
            function get_col(obj, colname, name_first) {
                icol = obj.column[colname];
                vec = obj.data.map(function (x) { return x[icol]; })
                if (typeof name_first == 'string') {
                    vec.unshift(name_first);
                } else if (name_first) {
                    vec.unshift(colname);
                }
                return vec;
            }

            var url = 'http://app.jrj.com.cn/appdata/data.php?cid=147&vname=sec_alldata&havingType=2&page=1&psize=150'
            var sec_alldata = null
            $.getScript(url, function() {
                var buy = get_col(sec_alldata, 'BUY_BALANCE', true);
                var datecol = 'Date'
                //console.debug(sec_alldata)
                //console.debug(buy)
                var chart = c3.generate({
                    bindto: '#chart',
                    data: {
                        x: datecol,
                        columns: [
                            get_col(sec_alldata, 'TRADEDATE', datecol),
                            buy,
                            get_col(sec_alldata, 'SELL_BALANCE', true),
                            //['data2', 50, 20, 10, 40, 15, 25]
                        ],
                        axes: {
                            BUY_BALANCE: 'y',
                            SELL_BALANCE: 'y2',
                        }
                    },
                    axis: {
                        x: {
                            type: 'timeseries',
                            tick: {
                                format: '%Y-%m-%d',
                            },
                        },
                        y2: {
                            show: true,
                        },
                    },
                    zoom: {
                        enabled: true,
                        rescale: true,
                    },
                })
            });
        </script>
    </body>
</html>
